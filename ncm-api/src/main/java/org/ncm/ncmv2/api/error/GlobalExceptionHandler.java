package org.ncm.ncmv2.api.error; import org.springframework.dao.DataIntegrityViolationException; import org.springframework.http.*; import org.springframework.web.bind.MethodArgumentNotValidException; import org.springframework.web.bind.annotation.*; import java.util.*; import java.util.stream.*;
@RestControllerAdvice public class GlobalExceptionHandler { @ExceptionHandler(MethodArgumentNotValidException.class) @ResponseStatus(HttpStatus.BAD_REQUEST) ProblemDetail onValidation(MethodArgumentNotValidException ex){ var pd = ProblemDetail.forStatus(HttpStatus.BAD_REQUEST); pd.setTitle("Validation failed"); pd.setProperty("errors", ex.getBindingResult().getFieldErrors().stream().map(e->Map.of("field",e.getField(),"message",e.getDefaultMessage())).collect(Collectors.toList())); return pd; } @ExceptionHandler(NoSuchElementException.class) @ResponseStatus(HttpStatus.NOT_FOUND) ProblemDetail onNotFound(NoSuchElementException ex){ var pd = ProblemDetail.forStatus(HttpStatus.NOT_FOUND); pd.setTitle("Not found"); pd.setDetail(ex.getMessage()); return pd; } @ExceptionHandler(DataIntegrityViolationException.class) @ResponseStatus(HttpStatus.CONFLICT) ProblemDetail onConstraint(DataIntegrityViolationException ex){ var pd = ProblemDetail.forStatus(HttpStatus.CONFLICT); pd.setTitle("Conflict"); pd.setDetail("Constraint violation"); return pd; } }
